#
#
use Tk::MMutil;
use Tk::Config;

Tk::MMutil::TkExtMakefile(
			  'CC' => 'gcc',
			  'LD' => 'gcc',
			  'CCCDLFLAGS' => '-fPIC',
			  'NAME' => 'Tk::Zinc',
			  'OBJECT' => '$(O_FILES)',
			  'VERSION_FROM' => 'Zinc.pm',
			  'XS_VERSION' => $Tk::Config::VERSION,
##			  'INSTALLDIRS' => 'vendor',
			  'INC' => "-I. -I@PERL_TK_LIB@/pTk",
			  'LIBS' => ["-L/usr/X11R6/lib -lX11 -L.. -l@PACKAGE@@VERSION@"],
			  );

sub MY::test_via_harness {
    my($self, $perl, $tests) = @_;
# The following uncommented line disable the load of libTkzincx.yyy.so
# during the "make test". What is the reason of this line is totally obscure
# for me. C.Mertz 22/sept/2003
# 
#    $perl = "PERL_DL_NONLAZY=1 $perl" unless $Is_Win32;
    "\t$perl".q! -I$(INST_ARCHLIB) -I$(INST_LIB) -I$(PERL_ARCHLIB) -I$(PERL_LIB) -e 'use Test::Harness qw(&runtests $$verbose); $$verbose=$(TEST_VERBOSE); runtests @ARGV;' !."$tests\n";
}


# as this method is very similar to the previous one, I applied the same patch,
# even if it seems not being used for building Tk::Zinc C.Mertz 22/sept/2003
sub MY::test_via_script {
    my($self, $perl, $script) = @_;
#    $perl = "PERL_DL_NONLAZY=1 $perl" unless $Is_Win32;
    qq{\t$perl}.q{ -I$(INST_ARCHLIB) -I$(INST_LIB) -I$(PERL_ARCHLIB) -I$(PERL_LIB) }.qq{$script
};
}
